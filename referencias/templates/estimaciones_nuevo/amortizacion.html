{% extends 'base.html' %}

{% block content %}
<div class="max-w-6xl mx-auto px-4 py-10">
  <h1 class="text-2xl font-bold text-center mb-6">Amortización de la Estimación #{{ estimacion.numero_estimacion }}</h1>

  <form method="POST" action="{{ url_for('estimaciones_nuevo.amortizacion_estimacion', estimacion_id=estimacion.id) }}">
    <table class="min-w-full table-auto text-sm text-right border rounded shadow">
      <thead class="bg-gray-100 text-gray-700">
        <tr>
          <th class="px-4 py-2 text-left">Concepto</th>
          <th class="px-4 py-2">Monto</th>
          <th class="px-4 py-2">IVA (16%)</th>
          <th class="px-4 py-2">Total con IVA</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-t">
          <td class="px-4 py-2 text-left font-semibold">Porcentaje del Anticipo</td>
          <td class="px-4 py-2">{{ porcentaje_anticipo }}%</td>
          <td class="px-4 py-2"></td>
          <td class="px-4 py-2"></td>
        </tr>
        <tr class="border-t">
          <td class="px-4 py-2 text-left font-semibold">Monto del Anticipo</td>
          <td class="px-4 py-2">${{ '%.2f'|format(anticipo_base) }}</td>
          <td class="px-4 py-2">${{ '%.2f'|format(iva_anticipo) }}</td>
          <td class="px-4 py-2">${{ '%.2f'|format(total_anticipo) }}</td>
        </tr>
        <tr class="border-t">
          <td class="px-4 py-2 text-left font-semibold">Amortización Estimación</td>
          <td class="px-4 py-2">
            <input type="number" step="0.01" min="0" max="{{ total_anticipo }}" name="amortizacion"
                   value="{{ estimacion.amortizacion or anticipo_base }}" class="w-full text-right border rounded px-2 py-1" required>
          </td>
          <td class="px-4 py-2">${{ '%.2f'|format(iva_amortizacion) }}</td>
          <td class="px-4 py-2">${{ '%.2f'|format(total_amortizacion) }}</td>
        </tr>
        <tr class="border-t bg-gray-100 font-semibold">
          <td class="px-4 py-2 text-left">Subtotal Estimación</td>
          <td class="px-4 py-2">${{ '%.2f'|format(subtotal_estimacion) }}</td>
          <td></td>
          <td></td>
        </tr>
        <tr class="border-t bg-gray-100 font-semibold">
          <td class="px-4 py-2 text-left">Saldo por Amortizar</td>
          <td class="px-4 py-2">${{ '%.2f'|format(saldo_amortizar) }}</td>
          <td class="px-4 py-2">${{ '%.2f'|format(iva_saldo) }}</td>
          <td class="px-4 py-2">${{ '%.2f'|format(total_saldo) }}</td>
        </tr>
      </tbody>
    </table>

    <div class="mt-6 flex justify-end">
      <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded font-semibold shadow">
        Guardar Amortización
      </button>
    </div>
  </form>
</div>
{% endblock %}